<div class="grid assinatura">    

    <p-toast position="center"></p-toast>

    <div class="div-loading" [class.mostrar-loading]="mostrarLoading">
        <svg viewBox="25 25 50 50" class="p-progress-spinner-svg" style="animation-duration: 2s;"><circle cx="50" cy="50" r="20" stroke-miterlimit="10" class="p-progress-spinner-circle" fill="none" stroke-width="2"></circle></svg>
    </div>
    
    <button *ngIf="passo == 1 || passo == 2" (click)="enviarEmail()" type="button" class="p-button-success enviar-email" icon="pi pi-id-card" pButton pRipple label="Enviar arquivos para assinar"></button>

    <div class="p-field col-12">
        <h2>Etapas da Assinatura dos arquivos RDV</h2>
        <div class="container-passos">
            <span class="passos" [ngClass]="{'selecionado': passo === 1}">
                <h5>PASSO 1</h5>
                Faça o upload dos arquivos que serão assinados
            </span>
            <span class="passos" [ngClass]="{'selecionado': passo === 2}">
                <h5>PASSO 2</h5>
                Confirme seu e-mail e clique no botão <i>Enviar arquivos para assinar</i>
            </span>
            <span class="passos" [ngClass]="{'selecionado': passo === 3}">
                <h5>PASSO 3</h5>
                Clique no botão <i>Assinar arquivos</i>
            </span>
            <span class="passos" [ngClass]="{'selecionado': passo === 4}">
                <h5>PASSO 4</h5>
                Clique no botão <i>Verificar assinatura</i>
            </span>
        </div>
    </div>

    <div class="p-field col-12">        
        <button type="button" style="box-sizing: border-box; width: 25%;" class="label-fixo-2" pButton pRipple label="E-mail do Assinante"></button>
        <input [disabled]="!(passo == 1 || passo == 2)" [readonly]="!(passo == 1 || passo == 2)" pInputText style="box-sizing: border-box; width: 75%;" type="email" [(ngModel)]="EmailAssinante">                    
    </div>

    <div class="p-field col-12">        
        <button class="p-button-raised p-button-text p-button-secondary" style="box-sizing: border-box; width: 50%;" type="button" icon="pi pi-file-pdf" pButton pRipple label="Status da Assinatura Digital"></button>
        <button *ngIf="passo == 5" icon="pi pi-check-square" class="p-button-success" style="box-sizing: border-box; width: 50%;" type="button" pButton pRipple label="{{obterStatusAssinatura()}}"></button>
        <button *ngIf="passo != 5" icon="pi pi-file-excel" class="p-button-warning" style="box-sizing: border-box; width: 50%;" type="button" pButton pRipple label="{{obterStatusAssinatura()}}"></button>
    </div>

    <div class="p-field col-12">                                    
        <button [disabled]="!(passo == 3 || passo == 4)" (click)="assinarArquivos()" type="button" class="p-button-success" [ngClass]="{'botao-cinza': !(passo == 3 || passo == 4)}" icon="pi pi-id-card" style="box-sizing: border-box; width: 31%;" pButton pRipple label="Assinar arquivos"></button>
        <button [disabled]="!(passo == 3 || passo == 4)" (click)="verificarAssinatura()" type="button" class="p-button-success" [ngClass]="{'botao-cinza': !(passo == 3 || passo == 4)}" icon="pi pi-sync" style="box-sizing: border-box; width: 31%; margin-left: 3.5%; margin-right: 3.5%;" pButton pRipple label="Verificar assinatura"></button>
        <button [disabled]="passo != 5" (click)="downloadArquivoAssinado()" type="button" class="p-button-success" [ngClass]="{'botao-cinza': passo != 5}" icon="pi pi-arrow-down" style="box-sizing: border-box; width: 31%;" pButton pRipple label="Baixar arquivo"></button>
    </div>

    <div class="p-field col-12">
        <h2>Arquivos para assinar</h2>
        <div class="p-field">
            
            <!-- Atenção: não pude reutilizar o componente app-arquivos pois há detalhes específicos aqui -->

            <p-fileUpload [disabled]="passo > 2" name="anexos[]" accept="application/pdf" customUpload="true" chooseLabel="Anexos"
                [auto]="true" (uploadHandler)="uploadAnexos($event)" maxFileSize="1000000000" multiple="multiple">

                <ng-template pTemplate="toolbar">
                </ng-template>
                <ng-template let-file pTemplate="file">
                </ng-template>

                <ng-template pTemplate="content">

                    <p-table [value]="DadosAssinatura.Assinatura.Arquivos" width="100%">
                    <ng-template pTemplate="header" let-columns>
                        <tr>
                        <th>Arquivo</th>
                        <th></th>
                        </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-file>
                        <tr>
                            <td (click)="abrirArquivo(file.Id)">
                                <i class="pi pi-file-pdf"></i>
                                {{file.FileName}}
                            </td>
                            <td style="width: 200px;">
                                <button [disabled]="passo > 2" pButton icon="pi pi-trash" class="p-button-danger" label="Apagar"
                                (click)="apagarAnexo(file.Id)"></button>
                            </td>
                        </tr>
                    </ng-template>
                    </p-table>

                </ng-template>
                </p-fileUpload>

            <!--<app-anexos [listaArquivos]='DadosAssinatura.Assinatura.Arquivos' [callbackFunction]="uploadCompleto"></app-anexos>-->
        </div>
    </div>

</div>